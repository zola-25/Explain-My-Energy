@inherits FluxorComponent
@inject IDispatcher Dispatcher

@if (ParametersSet)
{
    <MudCard Elevation="0">
        <MudCardHeader>
            <MudText Typo="Typo.h6">@MeterType Meter Authorization</MudText>
            <MudAlert Severity="Severity.Info"></MudAlert>
        </MudCardHeader>
        <MudCardContent Style="height: auto;
                                       min-height: 100%;">

            <div class="mb-1">
                <MudTextField Label="@MpxnLabel" Value="@MeterSetupState.Value[MeterType].Mpxn" ReadOnly="true"></MudTextField>
                <MudTextField Label='IHD MAC ID' Value="@HouseholdState.Value.IhdMacId" ReadOnly="true"></MudTextField>
                <MudTextField Label='Move-in Date' Value="@MoveInDateString" ReadOnly="true"></MudTextField>
            </div>
            <div class="mb-1">
                <MudButton @onclick="CheckAuthorization" Variant="Variant.Filled" hidden="@AuthorizeSucceeded">Confirm Authorization</MudButton>
            </div>


            <div id="authorizationSuccess" class="mt-2" hidden="@(!AuthorizeSucceeded)">

                <MudText Color="Color.Success" Typo="Typo.h5">Authorization Succeeded</MudText>
                <MudText>Your meter data is now being loaded</MudText>

            </div>

            <div id="authorizationFailed" hidden="@(!AuthorizeFailed)">
                <p class="text-warning">Authorization Failed</p>
                <p>We could not access your smart meter data - have you completed the authorization process with n3rgy?</p>
                <p>n3rgy responded with: @MeterProblemMessage</p>
            </div>

            <iframe id="n3rgy-iframe" src="https://data.n3rgy.com/consumer-sign-up" style="width: 100%; height: 1000px;" hidden="@_authorizeSucceeded"></iframe>

        </MudCardContent>
        <MudCardActions>
        </MudCardActions>
    </MudCard>
}